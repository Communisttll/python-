{% extends 'retrieval/base.html' %}
{% load static %}

{% block title %}上传检索 - AI图像检索系统{% endblock %}

{% block content %}
<!-- 上传区域 -->
<div class="container">
    <div class="row">
        <div class="col-12">
            <h2 class="text-center mb-5 section-title">
                <i class="fas fa-upload"></i> 上传图片进行检索
            </h2>
        </div>
    </div>
    
    <div class="row">
        <div class="col-lg-8 mx-auto">
            <form id="uploadForm" method="post" enctype="multipart/form-data" action="{% url 'retrieval:upload' %}">
                {% csrf_token %}
                
                <!-- 拖拽上传区域 -->
                <div id="uploadArea" class="upload-area">
                    <div class="text-center">
                        <i class="fas fa-cloud-upload-alt fa-3x text-muted mb-3"></i>
                        <h4>拖拽图片到此处或点击上传</h4>
                        <p class="text-muted">
                            支持 JPG、PNG、GIF 格式，文件大小不超过 10MB
                        </p>
                        <input type="file" id="fileInput" name="image" accept="image/*" style="display: none;">
                    </div>
                </div>
                
                <!-- 图片预览 -->
                <div id="imagePreview" class="text-center mb-4"></div>
                
                <!-- 上传按钮 -->
                <div class="text-center">
                    <button type="submit" id="uploadBtn" class="btn btn-primary btn-lg btn-custom" style="display: none;">
                        <i class="fas fa-search"></i> 开始检索
                    </button>
                </div>
            </form>
            
            <!-- 加载状态 -->
            <div id="loadingSpinner" class="loading-spinner">
                <div class="spinner-border text-primary" role="status" style="width: 3rem; height: 3rem;">
                    <span class="visually-hidden">加载中...</span>
                </div>
                <h5 class="mt-3">正在分析图片，请稍候...</h5>
                <p class="text-muted">系统正在提取特征并搜索相似图像</p>
            </div>
            
            <!-- 结果展示区域 -->
            <div id="resultsContainer" class="row" style="display: none;"></div>
        </div>
    </div>
</div>

<!-- 使用说明 -->
<div class="container mt-5">
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">
                        <i class="fas fa-info-circle"></i> 使用说明
                    </h5>
                    <div class="row">
                        <div class="col-md-6">
                            <h6>支持的图片格式：</h6>
                            <ul>
                                <li>JPEG/JPG</li>
                                <li>PNG</li>
                                <li>GIF</li>
                                <li>BMP</li>
                            </ul>
                        </div>
                        <div class="col-md-6">
                            <h6>检索说明：</h6>
                            <ul>
                                <li>系统会自动提取图像特征</li>
                                <li>在本地图库中搜索相似图像</li>
                                <li>同时从在线资源获取相似图片</li>
                                <li>提供详细的相似度分析</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// 上传页面的特定功能
document.addEventListener('DOMContentLoaded', function() {
    // 结果展示动画
    function animateResults() {
        const resultCards = document.querySelectorAll('.result-card');
        resultCards.forEach((card, index) => {
            setTimeout(() => {
                card.style.opacity = '0';
                card.style.transform = 'translateY(20px)';
                card.style.transition = 'all 0.5s ease';
                
                setTimeout(() => {
                    card.style.opacity = '1';
                    card.style.transform = 'translateY(0)';
                }, 100);
            }, index * 100);
        });
    }
    
    // 在结果显示后触发动画
    const observer = new MutationObserver(function(mutations) {
        mutations.forEach(function(mutation) {
            if (mutation.type === 'childList' && mutation.addedNodes.length > 0) {
                setTimeout(animateResults, 500);
            }
        });
    });
    
    const resultsContainer = document.getElementById('resultsContainer');
    if (resultsContainer) {
        observer.observe(resultsContainer, { childList: true, subtree: true });
    }
});
</script>
{% endblock %}