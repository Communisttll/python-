{% extends 'retrieval/base.html' %}
{% load static %}

{% block title %}图库 - AI图像检索系统{% endblock %}

{% block content %}
<div class="container">
    <div class="row">
        <div class="col-12">
            <h2 class="text-center mb-5 section-title">
                <i class="fas fa-images"></i> 图像图库
            </h2>
        </div>
    </div>
    
    <!-- 图库统计 -->
    <div class="row mb-4">
        <div class="col-lg-4">
            <div class="card text-center">
                <div class="card-body">
                    <h3 class="text-primary">{{ images|length }}</h3>
                    <p class="text-muted">展示图片数量</p>
                </div>
            </div>
        </div>
        <div class="col-lg-4">
            <div class="card text-center">
                <div class="card-body">
                    <h3 class="text-success">10000+</h3>
                    <p class="text-muted">图库总容量</p>
                </div>
            </div>
        </div>
        <div class="col-lg-4">
            <div class="card text-center">
                <div class="card-body">
                    <h3 class="text-warning">768</h3>
                    <p class="text-muted">特征维度</p>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 图库网格 -->
    <div class="gallery-grid">
        {% for image in images %}
            <div class="gallery-item">
                <img src="{{ image.path }}" alt="{{ image.filename }}" class="img-fluid">
                <div class="gallery-overlay">
                    <div class="gallery-info">
                        <h6>{{ image.filename|truncatechars:30 }}</h6>
                        <p class="text-muted">{{ image.filename }}</p>
                    </div>
                </div>
            </div>
        {% empty %}
            <div class="col-12 text-center">
                <div class="card">
                    <div class="card-body">
                        <i class="fas fa-image fa-3x text-muted mb-3"></i>
                        <h5>图库为空</h5>
                        <p class="text-muted">请先下载图片到图库目录</p>
                        <a href="{% url 'retrieval:index' %}" class="btn btn-primary">
                            <i class="fas fa-arrow-left"></i> 返回首页
                        </a>
                    </div>
                </div>
            </div>
        {% endfor %}
    </div>
    
    <!-- 说明信息 -->
    <div class="row mt-5">
        <div class="col-12">
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">
                        <i class="fas fa-info-circle"></i> 关于图库
                    </h5>
                    <p class="card-text">
                        本图库包含了从网络下载的10000+张多样化图像，涵盖了风景、人物、动物、建筑、物品等多个类别。
                        每张图像都经过DINOv2模型提取了768维的特征向量，用于支持高效的相似度检索。
                    </p>
                    <div class="row">
                        <div class="col-md-6">
                            <h6>图库特点：</h6>
                            <ul>
                                <li>多样化的图像内容</li>
                                <li>高质量的特征提取</li>
                                <li>支持快速相似度检索</li>
                                <li>持续的图库更新</li>
                            </ul>
                        </div>
                        <div class="col-md-6">
                            <h6>使用方式：</h6>
                            <ul>
                                <li>上传图片进行检索</li>
                                <li>查看相似图像结果</li>
                                <li>分析特征相似度</li>
                                <li>获取详细检索报告</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_css %}
<style>
.gallery-item {
    position: relative;
    border-radius: 10px;
    overflow: hidden;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    transition: transform 0.3s ease;
}

.gallery-item:hover {
    transform: scale(1.05);
}

.gallery-item img {
    width: 100%;
    height: 200px;
    object-fit: cover;
}

.gallery-overlay {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.7);
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    transition: opacity 0.3s ease;
}

.gallery-item:hover .gallery-overlay {
    opacity: 1;
}

.gallery-info {
    text-align: center;
    padding: 1rem;
}

.gallery-info h6 {
    margin-bottom: 0.5rem;
    font-weight: 600;
}

.gallery-info p {
    margin: 0;
    font-size: 0.9rem;
    opacity: 0.8;
}
</style>
{% endblock %}